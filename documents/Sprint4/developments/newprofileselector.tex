\subsection{Implement new Profile Selector}\label{sec:sprint3:devprofileselector}

As described in \cref{sec:sprint3:designprofileselector}, the new Profile Selector is ready to be implemented.

It was implemented by adding the \lstinline!GWidgetProfileSelection! as a view in the home.xml and settings.xml files.
This is the button showing the profile picture of the current user.
This component is attached an \lstinline!OnClickListener!, which should call the profile selector dialogbox, \lstinline!GProfileSelector!.
The code can be seen in \cref{lst:newprofileselectoronclick}

\begin{lstlisting}[caption={The OnClickListener for the Profile Selector button.}, label={lst:newprofileselectoronclick}]
mWidgetProfileSelection.setOnClickListener(new View.OnClickListener() {
	@Override
	public void onClick(View v) {
		mProfileSelectorDialog.show();
	}
});
\end{lstlisting}

The \lstinline!GProfileSelector! object is instantiated as such:\\

\begin{center}
\lstinline!mProfileSelectorDialog = new GProfileSelector(mContext, mLoggedInGuardian, mCurrentUser);!
\end{center}

However, this way of instantiating the object means that every time a new user is chosen on the list, the selector must be instantiated again with a new current user.
This is insured by attaching an \lstinline!OnListItemClickListener! for the object, which instantiates itself again.
Furthermore, it is reset up to recursively attach the listener, so it works each time the \lstinline!GWidgetProfileSelection! button is clicked.
The listener can be seen \cref{lst:newprofileselectoronitemclick}.

\begin{lstlisting}[caption={The recursive method setting instantiating the Profile Selector with the correct arguments each time a new user is selected.}, label={lst:newprofileselectoronitemclick}]
/**
* Updates the ProfileSelector. It is needed when a new user has been selected, as a different
* listener is needed, and the app container has to be reloaded.
* */
private void updatesProfileSelector(){
 mProfileSelectorDialog.setOnListItemClick(new AdapterView.OnItemClickListener() {
  @Override
  public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {
   ProfileController pc = new ProfileController(mContext);
   mCurrentUser = pc.getProfileById((int) l);
   mProfileSelectorDialog.dismiss();
  
   if (mCurrentUser.getRole() != Profile.Roles.GUARDIAN)
    mProfileSelectorDialog = new GProfileSelector(mContext, mLoggedInGuardian, mCurrentUser);
   else
    mProfileSelectorDialog = new GProfileSelector(mContext, mLoggedInGuardian, null);
  
   mWidgetProfileSelection.setImageBitmap(mCurrentUser.getImage());
  
   updatesProfileSelector();
  
   //Reload the application container, as a new user has been selected.
   reloadApplications();
  }
 });
} 
\end{lstlisting}